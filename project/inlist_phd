!low and intermediate mass

&star_job

      history_columns_file = 'my_history_columns.list'
      profile_columns_file = 'my_profile_columns.list'
      pause_before_terminate = .true.
      ! display on-screen plots
      pgstar_flag = .true.

      ! Rotation off until near ZAMS
      !change_rotation_flag = .false.
      !new_rotation_flag = .true.
      !new_surface_rotation_v = 20 ! solar (km sec^1) or new_omega_div_omega_crit = 0.057 (adimensional)
      ! to turn on rotation when near zams
      ! if rotation_flag is false and L_nuc_burn_total >= L_phot and this control > 0
      ! then turn on rotation and set set_surf_rotation_v_step_limit to
      ! the current model_number plus this control      
      !set_near_zams_surface_rotation_v_steps = 10 

      ! turn on rotation near zams
      !near_zams_relax_omega_div_omega_crit = .true.  ! turn on rotation at zams
      !num_steps_to_relax_rotation = 100              ! this number steps in the relaxation to the desired value   
      !new_omega_div_omega_crit = 0.50d0              ! desired zams value of rotation

      ! turn on PMS
      new_rotation_flag = .true.
      change_rotation_flag = .true.
      !change_initial_rotation_flag = .true.
      new_omega_div_omega_crit = 0.014
      set_omega_div_omega_crit = .true.

      !new_surface_rotation_v = 20.0 ! km/s     
      !set_surface_rotation_v = .true.      

      
!PMS
  ! begin with a pre-main sequence model  
      create_pre_main_sequence_model = .true.
    ! Initial center temperature (must be below 1d6)  
      pre_ms_T_c = 5d5

!MISC. SETUP
    
      history_columns_file = 'my_history_columns.list'
      save_model_filename = '1M_photosphere_tables_pAGB.mod'
      save_model_when_terminate = .true.
    
      !parameters to be used for mass on/off for rotation
      extras_lrpar = 3
      extras_rpar(1) = 1.2 !full off
      extras_rpar(2) = 1.8 !full on
      extras_rpar(3) = 0.4 !omega_div_omega_crit

!OPACITY, NETWORK, RATE, etc.

      !network 
      change_net = .true.
      new_net_name = 'mesa_49.net'
    
      !first 100 models are run with simple_photosphere then switched to the following
      extras_lcpar = 1
      extras_cpar(1) = 'photosphere_tables'
    
      !opacities with AGSS09 abundances
      kappa_file_prefix = 'a09'
      kappa_lowT_prefix = 'lowT_fa05_a09p'
      kappa_CO_prefix = 'a09_co'

      !use jina
      set_rates_preference = .true.
      new_rates_preference = 2

!CHANGE SOLAR ABUNDANCES

      set_uniform_initial_composition = .true.
      !initial_h1 = 7.154D-01
      !initial_h2 = 0
      !initial_he3 = 0
      !initial_he4 = 2.703D-01
      
      !According to Choi's feedback
      initial_h1 = 0.715399992
      initial_h2 = 1.430799984e-05
      initial_he3 = 4.48623528494e-05
      initial_he4 = 0.270255137647
      !!for initial Z = 0.0142857
      !for initial Z = <<Z>>

      initial_zfracs = 6 ! AGSS09_zfracs
            
/ ! end of star_job namelist

&controls

      report_why_dt_limits = .false.
      initial_mass = 1.0

!OUTPUT OPTIONS

      history_interval = 1
      terminal_interval = 10
      write_header_frequency = 10
      photo_digits = 5
      !photostep = 250 replaced by photo_interval
      photo_interval = 250

      star_history_dbl_format = '(1pes32.16e3, 1x)'
      star_history_int_format = '(i32, 1x)'
      star_history_txt_format = '(a32, 1x)'

      star_history_name = '1M_photosphere_history.data'
      write_controls_info_with_profile = .false.
      !write_profiles_flag = .false.
      !This option is changed to true
      write_profiles_flag = .true.

!WHEN TO STOP

      !in run_star_extras, it's set to H1 depletion in the core for low mass stars
      !gamma_center_limit = 20.0
      ! stop when the center mass fraction of h1 drops below this limit
      xa_central_lower_limit_species(1) = 'h1'
      xa_central_lower_limit(1) = 1d-9      
            
!PHYSICS

      !only for the first 100 model steps
      which_atm_option = 'simple_photosphere'

      use_Ledoux_criterion = .true.
      alpha_semiconvection = 0.1
      thermohaline_coeff = 666.0

      mixing_length_alpha = 1.82
      mlt_option = 'Henyey'
    
      !to help with convergence
      okay_to_reduce_gradT_excess = .true.
      Pextra_factor = 2.0

      !H core overshoot calibrated to M67
      overshoot_f_above_nonburn_core = 0.016
      overshoot_f_above_burn_h_core  = 0.016
      overshoot_f_above_burn_he_core = 0.016
      overshoot_f_above_burn_z_core  = 0.016
      overshoot_f0_above_nonburn_core = 0.008
      overshoot_f0_above_burn_h_core  = 0.008
      overshoot_f0_above_burn_he_core = 0.008
      overshoot_f0_above_burn_z_core  = 0.008

      !envelope overshoot calibrated to the sun
      overshoot_f_above_nonburn_shell = 0.0174
      overshoot_f_below_nonburn_shell = 0.0174
      overshoot_f_above_burn_h_shell  = 0.0174
      overshoot_f_below_burn_h_shell  = 0.0174
      overshoot_f_above_burn_he_shell = 0.0174
      overshoot_f_below_burn_he_shell = 0.0174
      overshoot_f_above_burn_z_shell  = 0.0174
      overshoot_f_below_burn_z_shell  = 0.0174
      overshoot_f0_above_nonburn_shell = 0.0087
      overshoot_f0_below_nonburn_shell = 0.0087
      overshoot_f0_above_burn_h_shell  = 0.0087
      overshoot_f0_below_burn_h_shell  = 0.0087
      overshoot_f0_above_burn_he_shell = 0.0087
      overshoot_f0_below_burn_he_shell = 0.0087
      overshoot_f0_below_burn_z_shell  = 0.0087
      overshoot_f0_above_burn_z_shell  = 0.0087

      !enhance `overshoot_f_below_nonburn_shell` by this factor during 3DUP in TPAGB
      overshoot_below_noburn_shell_factor = 10
      
      !CO enhanced opacities
      use_Type2_opacities = .true.
      kap_Type2_full_off_X = 1d-3
      kap_Type2_full_on_X = 1d-6
      Zbase = 0.00 ! this is set to Z of the star in run_star_extras.f
    
      !rotational mixing if applicable
      D_SH_factor =  1.0
      D_SSI_factor = 1.0
      D_ES_factor =  1.0
      D_GSF_factor = 1.0
      D_DSI_factor = 1.0
      D_ST_factor = 0.0
      am_D_mix_factor = 0.033
      am_gradmu_factor = 0.05

      ! mass loss       
      use_other_wind = .true.
      cool_wind_RGB_scheme = 'Reimers'
      cool_wind_AGB_scheme = 'Blocker'
      RGB_to_AGB_wind_switch = 1d-4
      Reimers_scaling_factor = 0.1
      Blocker_scaling_factor = 0.2
      max_wind = 1d-3

      ! toggle element diffusion
      do_element_diffusion = .true.
      diffusion_dt_limit = 3.15e13
      diffusion_min_T_at_surface = 1d3
      ! If true, don't lump elements into classes for diffusion. 
      ! Instead, each isotope in the network is treated as its 
      ! own separate class. This can cause significant slowdowns 
      ! for large nets, so it is off by default.
      ! diffusion_use_full_net = .true.  <--TFM option
      diffusion_use_full_net = .false.
      diffusion_use_cgs_solver = .false.


      radiation_turbulence_coeff = 1.0
    
      !to help with breathing pulses
      include_dmu_dt_in_eps_grav = .true.

!CORE MASS DEFINITION

      he_core_boundary_h1_fraction = 1d-4
      c_core_boundary_he4_fraction = 1d-4
      o_core_boundary_c12_fraction = 1d-4
        
!MESH AND TIMESTEP PARAMETERS

      mesh_delta_coeff = 1.0
      varcontrol_target = 1d-4
      max_allowed_nz = 50000
    
      !better resolution of the Henyey hook
      delta_lg_XH_cntr_max = -1

      ! limit for magnitude of max change
      delta_lgTeff_limit = 0.005
      delta_lgTeff_hard_limit = 0.01
      delta_lgL_limit = 0.02 
      delta_lgL_hard_limit = 0.05
    
      !multiply mesh_delta_coeff in overshooting regions by this factor
      xtra_coef_os_above_nonburn = 0.5
      xtra_coef_os_below_nonburn = 0.5
      xtra_coef_os_above_burn_h = 0.5
      xtra_coef_os_below_burn_h = 0.5
      xtra_coef_os_above_burn_he = 0.5
      xtra_coef_os_below_burn_he = 0.5
      xtra_coef_os_above_burn_z = 0.5
      xtra_coef_os_below_burn_z = 0.5
      
/ ! end of controls namelist

&pgstar

  History_Panels1_win_flag = .true.
  History_Panels1_num_panels = 3
  !History_Panels1_xaxis_name = 'star_age'
  History_Panels1_yaxis_name(3) = 'surf_avg_v_rot'

  TRho_Profile_win_flag = .true.
  show_TRho_Profile_legend = .true.
  show_TRho_Profile_text_info = .true.
  TRho_Profile_file_flag = .true.
  TRho_Profile_file_prefix = 'trho_'
  TRho_Profile_file_interval = 5  

  Abundance_win_flag = .true.
  Abundance_show_photosphere_location = .true.
  num_abundance_line_labels = 1
  Abundance_num_isos_to_show = 4
  Abundance_which_isos_to_show(1) = 'h1'
  Abundance_which_isos_to_show(2) = 'he4'
  Abundance_which_isos_to_show(3) = 'li7'
  Abundance_which_isos_to_show(4) = 'be7'
  Abundance_file_flag = .true.


  !Abundance_log_mass_frac_min = -20
  !Abundance_log_mass_frac_max = 0.3
  Abundance_log_mass_frac_min = -30
  Abundance_log_mass_frac_max = 10
  Abundance_file_interval = 5


  ! show HR diagram
  ! this plots the history of L,Teff over many timesteps
  HR_win_flag = .true.
  HR_file_flag = .true.
  HR_file_interval = 5

  
  ! Mirar para mostrar como varÃ­a las abundancias a lo largo de los modelos
  ! junto con temperatura
  Summary_History_win_flag = .false.

  Summary_Profile_win_flag = .false.
  Summary_Profile_num_lines = 7

  Summary_Profile_name(1) = 'x'
  Summary_Profile_legend(1) = 'X'
  Summary_Profile_scaled_value(1) = .false.

  Summary_Profile_name(2) = 'y'
  Summary_Profile_legend(2) = 'Y'
  Summary_Profile_scaled_value(2) = .false.

  Summary_Profile_name(3) = 'h1'
  Summary_Profile_legend(3) = 'h1'
  Summary_Profile_scaled_value(3) = .false.

  Summary_Profile_name(4) = 'li7'
  Summary_Profile_legend(4) = 'li7'
  Summary_Profile_scaled_value(4) = .false.

  Summary_Profile_name(5) = 'be7'
  Summary_Profile_legend(5) = 'be7'
  Summary_Profile_scaled_value(5) = .false.
  Summary_Profile_legend(5) = 'be7'

  Summary_Profile_name(6) = 'radius'
  Summary_Profile_legend(6) = 'r rel'

  Summary_Profile_name(7) = 'temperature'
  Summary_Profile_legend(7) = 'T rel'    

  History_Track2_win_flag = .true.
  History_Track2_xname = 'star_age'
  History_Track2_yname = 'surf_avg_omega_div_omega_crit'
  History_Track2_xaxis_label = 'star_age'
  History_Track2_yaxis_label = 'surf_avg_omega_div_omega_crit'
  History_Track2_reverse_xaxis = .false.
  History_Track2_reverse_yaxis = .false.
  History_Track2_log_xaxis = .true.
  History_Track2_log_yaxis = .false.  

  History_Track3_win_flag = .true.
  History_Track3_xname = 'star_age'
  History_Track3_yname = 'surf_avg_v_rot'
  History_Track3_xaxis_label = 'star_age'
  History_Track3_yaxis_label = 'surf_avg_v_rot'
  History_Track3_reverse_xaxis = .false.
  History_Track3_reverse_yaxis = .false.
  History_Track3_log_xaxis = .true.
  History_Track3_log_yaxis = .false.  


/ !end pgstart
